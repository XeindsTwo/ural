<section class="participation indent" id="participation">
  <div class="container">
    <h2 class="participation__title title-section">
      Принять <span>участие</span> <br> в конкурсе
    </h2>
    <div id="app">
      <form @submit.prevent="validateForm" class="participation__form" action="">
        <div class="participation__block">
          <span class="participation__label">Заполните контактные данные</span>
          <span class="error" :class="{ active: errors.contact }">Пожалуйста, заполните все поля</span>
          <div class="participation__fields">
            <label>
              <input v-model="form.contact.phone" class="input" type="text" name="phone" id="phone" data-tel-input placeholder="Свой номер телефона" :class="{ 'input--error': errors.contact && !form.contact.phone }">
            </label>
            <label>
              <input v-model="form.contact.messenger" class="input" type="text" name="messenger" id="messenger" placeholder="Менеджер Whatsapp / Tg" :class="{ 'input--error': errors.contact && !form.contact.messenger }">
            </label>
          </div>
        </div>
        <div class="participation__block">
          <span class="participation__label">Заполните свои личные данные</span>
          <span class="error" :class="{ active: errors.personal }">Пожалуйста, заполните все поля</span>
          <span class="error active" v-if="errors.ageMin">Минимальный возраст - 10 лет</span>
          <span class="error active" v-if="errors.ageMax">Максимальный возраст - 70 лет</span>
          <div class="participation__fields">
            <label>
              <input v-model="form.personal.fullName" class="input" type="text" name="fullName" id="fullName" placeholder="ФИО" :class="{ 'input--error': errors.personal && !form.personal.fullName }">
            </label>
            <label>
              <input v-model="form.personal.age" class="input" type="number" name="age" id="age" placeholder="Возраст" :class="{ 'input--error': (errors.personal || errors.ageMin || errors.ageMax) && !form.personal.age }">
            </label>
            <label class="participation__fields long">
              <input v-model="form.personal.address" class="input" type="text" name="address" id="address" placeholder="Место проживания" :class="{ 'input--error': errors.personal && !form.personal.address }">
            </label>
          </div>
        </div>
        <div class="participation__block">
          <span class="participation__label">Педагог <span>(при наличии)</span></span>
          <span class="error" :class="{ active: errors.teacher }">Пожалуйста, заполните все поля</span>
          <div class="participation__fields">
            <label>
              <input v-model="form.teacher.fullName" class="input" type="text" name="teacher_fullName" id="teacher_fullName" placeholder="ФИО" :class="{ 'input--error': errors.teacher && !form.teacher.fullName }">
            </label>
            <label>
              <input v-model="form.teacher.age" class="input" type="number" name="teacher_age" id="teacher_age" placeholder="Возраст" :class="{ 'input--error': errors.teacher && !form.teacher.age }" min="10" max="70">
            </label>
            <label class="participation__fields long">
              <input v-model="form.teacher.schoolName" class="input" type="text" name="teacher_schoolName" id="teacher_schoolName" placeholder="Название школы" :class="{ 'input--error': errors.teacher && !form.teacher.schoolName }">
            </label>
          </div>
        </div>
        <div class="participation__block">
          <span class="participation__label">Видеозаписи до 3 штук</span>
          <button class="participation__load" type="button">
            <div class="participation__info">
              <span class="participation__text">Перетащите сюда, для загрузки</span>
              <span class="participation__size">Максимальный размер: 5GB</span>
            </div>
          </button>
        </div>
        <button class="participation__btn" type="submit">Приступить к оплате</button>
      </form>
    </div>
  </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
  new Vue({
    el: '#app',
    data: {
      form: {
        contact: {
          phone: '',
          messenger: ''
        },
        personal: {
          fullName: '',
          age: '',
          address: ''
        },
        teacher: {
          fullName: '',
          age: '',
          schoolName: ''
        }
      },
      errors: {
        contact: false,
        personal: false,
        teacher: false,
        ageMin: false,
        ageMax: false
      }
    },
    methods: {
      validateForm() {
        this.errors.contact = !this.form.contact.phone || !this.form.contact.messenger;
        this.errors.personal = !this.form.personal.fullName || !this.form.personal.age || !this.form.personal.address;

        const teacherFields = [this.form.teacher.fullName, this.form.teacher.age, this.form.teacher.schoolName];
        const anyTeacherFieldFilled = teacherFields.some(field => field.trim() !== '');
        const allTeacherFieldsFilled = teacherFields.every(field => field.trim() !== '');
        this.errors.teacher = anyTeacherFieldFilled && !allTeacherFieldsFilled;

        // Validate age
        const age = parseInt(this.form.personal.age);
        this.errors.ageMin = age < 10;
        this.errors.ageMax = age > 70;

        if (!this.errors.contact && !this.errors.personal && !this.errors.teacher && !this.errors.ageMin && !this.errors.ageMax) {
          // Proceed to payment
        } else {
          setTimeout(() => {
            this.errors.contact = false;
            this.errors.personal = false;
            this.errors.teacher = false;
            this.errors.ageMin = false;
            this.errors.ageMax = false;
          }, 2800);
        }
      }
    }
  });
</script>